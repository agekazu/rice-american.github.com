
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>こめぶろぐ</title>
  <meta name="author" content="rice_american">

  
  <meta name="description" content="とあるディレクトリ以下のHTMLのファイルの総容量が知りたくてあれこれやってたら出来たのでメモ。 1
2
find $before_www -type f -name '*.html' -print0 | xargs -0 du -k &gt; $before_html_size
cat $ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rice-american.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="こめぶろぐ" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">こめぶろぐ</a></h1>
  
    <h2>rice_american's blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rice-american.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/24/dc/">DCコマンドで拡張子を指定して容量を表示する</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-24T22:55:27+09:00" pubdate data-updated="true">Sep 24<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>とあるディレクトリ以下のHTMLのファイルの総容量が知りたくてあれこれやってたら出来たのでメモ。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>find $before_www -type f -name '*.html' -print0 | xargs -0 du -k &gt; $before_html_size
</span><span class='line'>cat $before_html_size | awk '{ sum += $1 } END { print sum }' &gt;&gt; $before_html_size</span></code></pre></td></tr></table></div></figure>


<p>長い･･･</p>

<p>ちなみにキロバイトでなくバイト表記したい場合は<code>du -b</code>を指定すればいいらしいが、自分の環境のMBPでは<code>-b</code>が使えなかった。
調べてみると</p>

<p><a href="http://qiita.com/itochan/items/5042c178bd01e27b0c88">qiita &ndash; duコマンドのサイズをわかりやすく表示してサイズ順にソートする</a></p>

<blockquote><p>どうやらBSDの du はバイト単位で表示する機能がないようです。よって、du もcoreutilsのものを使う必要があります。</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew install coreutils</span></code></pre></td></tr></table></div></figure>


<p>した後で、<code>gdu -b</code>と指定することMacでも使えるようになった。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/22/heroku-icon/">Fonticonをherokuに適応するまで</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-22T14:14:57+09:00" pubdate data-updated="true">Mar 22<span>nd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>こうなるまでの道のり
<img src="https://f.cloud.github.com/assets/1464221/2489851/b68b3de6-b17b-11e3-8e4d-c30bd31adef2.png" alt="2014-03-22 13 37 24" /></p>

<p>前に書いた<a href="https://github.com/kanpe777/Mahjong/issues/24">herokuへdeployしたアプリケーションにwebfontを適用させる · Issue #24 · kanpe777/Mahjong</a>を参考にし、導入した。しかし、localでは反映されたが、heroku上ではfontfileやらcss,jsがNotFoundとなってしまい、webfontが表示されなかった(´・ω・`)</p>

<h2>対策</h2>

<p>色々探してみると次のような記事があった。</p>

<p><a href="http://shuzo-kino.hateblo.jp/entry/2014/03/21/221411">rails4でprecompileが必要なアプリをherokuにアップロードする &ndash; Bye Bye Moore</a></p>

<p>追記</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="c1">#/config/environments/production.rb</span>
</span><span class='line'>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">cache_classes</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">serve_static_assets</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">compile</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">digest</span> <span class="o">=</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>で、assets.pathについてだが、これは<a href="http://d.hatena.ne.jp/senggonghaza/20130711/1373530360">Rails4でハマった件、 &ndash; Railsプロになろう！</a>を見て、<code>app/config/environments/production.rb</code>ではなく、<code>app/config/application.rb</code>に書いた。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="c1">#/config/application.rb</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">paths</span> <span class="o">&lt;&lt;</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;assets&quot;</span><span class="p">,</span> <span class="s2">&quot;fonts&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">precompile</span> <span class="o">+=</span> <span class="sx">%w( .svg .eot .woff .ttf )</span>
</span></code></pre></td></tr></table></div></figure>


<p>この後、vagrantの方で<code>rake assets:precompile</code>を実行し、生成されたファイルを<code>git add</code>して、<code>git push heroku master</code>をすると･･･</p>

<p><img src="https://f.cloud.github.com/assets/1464221/2489916/c97f9492-b180-11e3-8d4c-d5b7dd8d38fc.png" alt="2014-03-22 14 11 25" />
読み込まれたッ！</p>

<p><img src="https://f.cloud.github.com/assets/1464221/2489851/b68b3de6-b17b-11e3-8e4d-c30bd31adef2.png" alt="2014-03-22 13 37 24" />
表示もされていますね( ´∀｀)</p>

<p>以上！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/08/jquery-lesson/">dotinstallでjQueryの勉強</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-08T20:20:30+09:00" pubdate data-updated="true">Mar 8<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>やってみた。
* <a href="http://dotinstall.com/lessons/basic_jquery_v2">jQuery入門 (全15回) &ndash; プログラミングならドットインストール</a></p>

<p>以降はメモ。</p>

<h3>01 jQueryとはなにか</h3>

<p>jsを便利に使うためのライブラリです。</p>

<p>jQueryライブラリ読み込み</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://code.jquery.com/jquery-1.11.0.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>02初めてのjQuery</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;ja&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;discription&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;.css&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;title&gt;</span>jQueryの練習 <span class="nt">&lt;/title&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://code.jquery.com/jquery-1.11.0.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script&gt;</span>
</span><span class='line'>  <span class="c1">//  $(document.read(function(){}) → html本文が読み込まれたら実行するという意味、下のように書ける↓</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="c1">// セレクタ: 処理対象となるDOM要素を指定する記法</span>
</span><span class='line'>    <span class="c1">// メソッド: 処理(.で繋げられる=&gt;メソッドチェーン</span>
</span><span class='line'>    <span class="c1">// pがセレクタ、.以降がメソッド。</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">(</span><span class="s1">&#39;slow&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;p&gt;</span>jQueryの練習<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>03</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>1<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>2<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>3<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;sub&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;</span>3-1<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;</span>3-2<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;item&quot;</span><span class="nt">&gt;</span>3-3<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;item&quot;</span><span class="nt">&gt;</span>3-4<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>4<span class="nt">&lt;/li&gt;</span>
</span><span class='line'><span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://code.jquery.com/jquery-1.11.0.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//  $(document.read(function(){})</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="c1">// セレクタ: 処理対象となるDOM要素を指定する記法</span>
</span><span class='line'>    <span class="c1">// メソッド: 処理(.で繋げられる=&gt;メソッドチェーン)</span>
</span><span class='line'>    <span class="c1">// pがセレクタ、.以降がメソッド。</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// セレクタメソッド </span>
</span><span class='line'>    <span class="c1">// $(&quot;~&quot;)</span>
</span><span class='line'>    <span class="c1">// html要素 p h1 ulとか</span>
</span><span class='line'>    <span class="c1">// id #main</span>
</span><span class='line'>    <span class="c1">// class .item</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#sub&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<pre><code>$("#sub").css('color', 'red');とすると
</code></pre>

<p>subclassの要素が赤くなる</p>

<h2>04もっとセレクタを使ってみよう</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  //  $(document.read(function(){})
</span><span class='line'>  $(function(){
</span><span class='line'>    // セレクタ: 処理対象となるDOM要素を指定する記法
</span><span class='line'>    // メソッド: 処理(.で繋げられる=&gt;メソッドチェーン)
</span><span class='line'>    // pがセレクタ、.以降がメソッド。
</span><span class='line'>
</span><span class='line'>    // セレクタメソッド
</span><span class='line'>    // #id .class
</span><span class='line'>    // &gt; 直下の子要素
</span><span class='line'>    // , 複数の要素
</span><span class='line'>    // + 隣接する要素
</span><span class='line'>      $(&quot;#main &gt; #sub &gt; .item&quot;).css(&#39;color&#39;, &#39;red&#39;);
</span><span class='line'>      $(&quot;#main .item&quot;).css(&#39;color&#39;, &#39;red&#39;);
</span><span class='line'>      $(&quot;p, .item&quot;).css(&#39;color&#39;, &#39;red&#39;);
</span><span class='line'>      $(&quot;.item + .item&quot;).css(&#39;color&#39;, &#39;red&#39;);
</span><span class='line'>  });
</span></code></pre></td></tr></table></div></figure>


<h2>05 フィルタを使ってみよう</h2>

<p>フィルタは:以降に指定します。
例えば
* :eq() →等しい
* :gt(), :lt() → より大きい、より小さい
* :even, :odd → 偶数、奇数
* :contains() → valueに含まれている値を指定する。
* :first :last → 最初と最後</p>

<p>実際に使ってみると</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>$(&quot;#sub &gt; li:eq(2)&quot;).css(&#39;color&#39;, &#39;blue&#39;);
</span></code></pre></td></tr></table></div></figure>


<p>は、subclass以下のli要素の2番めを指定する。(連番は0から始まる)</p>

<p><img src="https://f.cloud.github.com/assets/1464221/2353114/a302753e-a599-11e3-96a4-0c5f6a5a16df.png" alt="2014-03-07 10 41 24" /></p>

<p>containsは、valueに含まれている値をしていすると、その条件を満たす要素に適応される。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>// :eq()
</span><span class='line'>// :gt(), :lt()
</span><span class='line'>// :even, :odd
</span><span class='line'>// :contains()
</span><span class='line'>// :first :last
</span><span class='line'>// $(&quot;#sub &gt; li:eq(2)&quot;).css(&#39;color&#39;, &#39;blue&#39;);
</span><span class='line'>// $(&quot;#sub &gt; li:gt(0)&quot;).css(&#39;color&#39;, &#39;green&#39;);
</span><span class='line'>$(&quot;#sub &gt; li:contains(2)&quot;).css(&#39;color&#39;, &#39;green&#39;);
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://f.cloud.github.com/assets/1464221/2353182/c20e3f20-a59a-11e3-8266-7e11176298d0.png" alt="2014-03-07 10 49 31" /></p>

<p>id=sub以下の2を含むli要素だけが緑に。</p>

<h3>06 メソッドを使ったDOM要素指定</h3>

<ul>
<li>parent() 親要素を指す</li>
<li>children() 子要素を指す</li>
<li>siblings() 兄弟要素を指す。自分は含まない。</li>
<li>next() 要素の次の要素を指す</li>
<li>prev() 要素の前の要素を指す</li>
</ul>


<p><code>例 next()を使う</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  $(function(){
</span><span class='line'>
</span><span class='line'>    // parent(), children()
</span><span class='line'>    // next(), prev()
</span><span class='line'>    // siblings() - 兄弟要素
</span><span class='line'>    $(&quot;#sub &gt; li:eq(2)&quot;).next().css(&#39;color&#39;, &#39;green&#39;);
</span><span class='line'>  });
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://f.cloud.github.com/assets/1464221/2353208/cab4ab22-a59b-11e3-9364-714f77d6eae6.png" alt="2014-03-07 10 56 57" /></p>

<h3>07 属性セレクタを使ってみよう</h3>

<ul>
<li>= 等しい</li>
<li>!= 等しくない</li>
<li>*= 含まれる</li>
<li>^= 先頭一致</li>
<li>$= 末尾一致</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>$(function(){
</span><span class='line'>    $(&#39;a[href*=&quot;dot&quot;]&#39;).css(&quot;background&quot;,&quot;red&quot;);
</span><span class='line'>});
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://f.cloud.github.com/assets/1464221/2353315/22b427ba-a59e-11e3-94cb-b7436dcef8ee.png" alt="2014-03-07 11 13 42" /></p>

<h3>08 css､addClass/removeClassを使おう</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  $(function(){
</span><span class='line'>    $(&#39;p&#39;).css(&#39;color&#39;, &#39;red&#39;).css(&#39;background&#39;,&#39;blue&#39;);
</span><span class='line'>    console.log($(&#39;p&#39;).css(&#39;color&#39;));
</span><span class='line'>  });
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>$(&lsquo;p&rsquo;).css(&lsquo;color&rsquo;) で、colorを取ってこれる</li>
<li>こういうふうにcssをつなげて書くのは、拡張が面倒なので、styleとしてまとめておいたほうが良いです。</li>
</ul>


<p>styleの指定</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;title&gt;</span>jQueryの練習 <span class="nt">&lt;/title&gt;</span>
</span><span class='line'><span class="nt">&lt;style&gt;</span>
</span><span class='line'>  <span class="nc">.myStyle</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">border</span><span class="o">:</span> <span class="m">5px</span> <span class="k">solid</span> <span class="nb">green</span><span class="p">;</span>
</span><span class='line'>    <span class="k">font-size</span><span class="o">:</span><span class="m">48px</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="nt">&lt;/style&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>その後、</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  <span class="nt">&lt;script&gt;</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="c1">// $(&#39;p&#39;).css(&#39;color&#39;, &#39;red&#39;).css(&#39;background&#39;,&#39;blue&#39;);</span>
</span><span class='line'>    <span class="c1">// console.log($(&#39;p&#39;).css(&#39;color&#39;));</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;myStyle&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>ってやると、
<img src="https://f.cloud.github.com/assets/1464221/2353399/46ee3e16-a5a0-11e3-8f9a-0dd152296ba6.png" alt="2014-03-07 11 28 56" />
こうなる。removeClassで、除ける。</p>

<h3>09 attr､dataを使ってみよう</h3>

<ul>
<li>attr: 値をgetする奴。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>  <span class="nt">&lt;p&gt;</span>Hello, jQuery<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://google.com&quot;</span><span class="nt">&gt;</span>google<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://code.jquery.com/jquery-1.11.0.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script&gt;</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">));</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>でconsoleに<code>"http://google.com"</code>が表示される。
また、attrメソッドを使って、値を変えることもできる。
こうする。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  $(function(){
</span><span class='line'>      console.log($(&#39;a&#39;).attr(&#39;href&#39;,&#39;http://yahoo.co.jp&#39;));
</span><span class='line'>  });
</span></code></pre></td></tr></table></div></figure>


<p>カスタム属性を取得したいときはdataを使います。
html5ではカスタム属性をdata-のあとにつける。</p>

<p>bodyを次のように書くと</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://google.com&quot;</span> <span class="na">data-sitename=</span><span class="s">&quot;google&quot;</span><span class="nt">&gt;</span>google<span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  <span class="nt">&lt;script&gt;</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;sitename&#39;</span><span class="p">));</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>で値を取ってこれる。</p>

<h3>10 タグの中身を操作してみよう</h3>

<ul>
<li>text 指定したタグの要素に文字列を書く</li>
<li>html 指定したタグの要素にhtml文を書く</li>
<li>val 指定したタグの要素を書き換える</li>
<li>empty 指定したタグの要素を空にする</li>
<li>remove 指定したタグを消滅させる</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  $(&#39;p&#39;).text(&#39;just changed&#39;)
</span><span class='line'>  $(&#39;p&#39;).html(&#39;<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>click me<span class="nt">&lt;/a&gt;</span>&#39;)
</span><span class='line'>  console.log($(&#39;input&#39;).val());
</span><span class='line'>  $(&#39;input&#39;).val(&quot;hogehoge&quot;);
</span><span class='line'>  $(&#39;p&#39;).remove();
</span></code></pre></td></tr></table></div></figure>


<h3>11 要素を追加してみよう</h3>

<p>bodyに次のように書く</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  <span class="nt">&lt;p&gt;</span>Hello, jQuery<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;</span>0<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;</span>1<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;</span>2<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  <span class="nt">&lt;script&gt;</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="c1">// before, after == InsertBefore, InsertAfter</span>
</span><span class='line'>      <span class="c1">// prepend, append</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;just added&#39;</span><span class="p">);</span> <span class="c1">// あたらしいli要素</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;ul &gt; li:eq(1)&#39;</span><span class="p">).</span><span class="nx">before</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span> <span class="c1">// あたらしいli要素を追加する場所の指定</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>要素を追加するときは、不等号記号で囲ってやる必要がありけり。→ <code>&lt;li&gt;</code>
<img src="https://f.cloud.github.com/assets/1464221/2353692/7c39f716-a5a7-11e3-8996-be6fc1fdc398.png" alt="2014-03-07 12 20 45" /></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  var li2 = $(&#39;<span class="nt">&lt;li&gt;</span>&#39;).text(&#39;just added2&#39;);
</span><span class='line'>  $(&#39;ul&#39;).append(li2);
</span></code></pre></td></tr></table></div></figure>


<p>とすると、末尾にli2を追加してくれる。先頭に追加するには<code>prepend()</code>を使う。</p>

<h3>12 エフェクトを使ってみよう</h3>

<p><strong>アニメィション！</strong></p>

<ul>
<li>hide, show</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script&gt;</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="c1">// hide, show</span>
</span><span class='line'>      <span class="c1">// fadeIn, fadeOut</span>
</span><span class='line'>      <span class="c1">// toggle</span>
</span><span class='line'>      <span class="c1">// $(&#39;#box&#39;).fadeIn(1000);</span>
</span><span class='line'>      <span class="c1">// $(&#39;#box&#39;).fadeOut(1000);</span>
</span><span class='line'>      <span class="c1">// $(&#39;#box&#39;).toggle(1000);</span>
</span><span class='line'>      <span class="c1">// $(&#39;#box&#39;).toggle(1000);</span>
</span><span class='line'>      <span class="c1">// $(&#39;#box&#39;).fadeOut(200,function(){</span>
</span><span class='line'>      <span class="c1">//   alert(&quot;gone!!!!!!!!!!!!!!!!!!&quot;);</span>
</span><span class='line'>      <span class="c1">// });</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>13 イベントを使ってみよう</h3>

<p>mouseイベントについて</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script&gt;</span>
</span><span class='line'>  $(function(){
</span><span class='line'>      // clip event
</span><span class='line'>      // mouseover, mousemove
</span><span class='line'>      $(&#39;#box&#39;).click(function(){
</span><span class='line'>        console.log(&quot;hogehoge&quot;);
</span><span class='line'>      });
</span><span class='line'>      $(&#39;#box&#39;)
</span><span class='line'>        .mouseover(function(){
</span><span class='line'>          $(this).css(&#39;background&#39;,&#39;blue&#39;);
</span><span class='line'>      })
</span><span class='line'>        .mousemove(function(e
</span><span class='line'>             ){
</span><span class='line'>          $(this).text(e.pageX);
</span><span class='line'>      })
</span><span class='line'>        .mouseout(function(){
</span><span class='line'>          $(this).css(&#39;background&#39;,&#39;green&#39;);
</span><span class='line'>      });
</span><span class='line'>  });
</span></code></pre></td></tr></table></div></figure>


<h3>14 focus､blur､changeを使おう</h3>

<p>フォーカスされた時、フォーカスが外れた時、メニュー選択された時</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;ja&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;discription&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;.css&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;title&gt;</span>jQueryの練習 <span class="nt">&lt;/title&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>    <span class="nt">&lt;p&gt;</span>Hello, jQuery<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;members&quot;</span> <span class="na">name=</span><span class="s">&quot;members&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;option&gt;</span>hoge<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>      <span class="nt">&lt;option&gt;</span>fuga<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>      <span class="nt">&lt;option&gt;</span>piyo<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/select&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://code.jquery.com/jquery-1.11.0.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script&gt;</span>
</span><span class='line'>      <span class="c1">// focus フォーカスされた時</span>
</span><span class='line'>      <span class="c1">// blur  フォーカスから外れた時</span>
</span><span class='line'>      <span class="c1">// change ボトムダウンメニューから選択された時</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>          <span class="c1">// focusされた時の処理</span>
</span><span class='line'>          <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#name&quot;</span><span class="p">).</span><span class="nx">focus</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;background&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>          <span class="c1">// blur</span>
</span><span class='line'>          <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#name&quot;</span><span class="p">).</span><span class="nx">blur</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;background&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#members&#39;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s2">&quot;aho&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>15 onメソッドを使ってみよう</h3>

<h4>onメソッドは、jQueryで動的に生成された要素に対して操作するためのメソッド。</h4>

<p><code>$(function())</code>では、htmlが読み込まれた段階での要素に対して操作を行うため、jQuery
で生成された要素に対しては操作できない。そこで、<code>onメソッド</code>を使う。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;ja&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;discription&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;.css&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;title&gt;</span>jQueryの練習 <span class="nt">&lt;/title&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>    <span class="nt">&lt;p&gt;</span>Hello, jQuery<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>    <span class="nt">&lt;button&gt;</span>add!<span class="nt">&lt;/button&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://code.jquery.com/jquery-1.11.0.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script&gt;</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;add!&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;vanish&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">before</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;.vanish&#39;</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>              <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
</span><span class='line'>          <span class="p">}));</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://f.cloud.github.com/assets/1464221/2353964/33017fc6-a5af-11e3-9d34-1895500a6079.png" alt="2014-03-07 13 15 57" /></p>

<p>addボタンを押すと&#8221;add!&ldquo;が追加される。で、&#8221;add!&#8221;をクリックすると消える。これはonメソッドのため。</p>

<p>以上！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/07/rails-sec-login/">Railsで、暗号化されたpasswordを使ってログイン機構を作ってみる。</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-07T13:23:17+09:00" pubdate data-updated="true">Mar 7<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前回でpasswordの暗号化までいけたので、今度はそれを使ってログインするところまで。
参考: <a href="http://qiita.com/regonn/items/4c76d4f3ef6c6af5c5e5">Rails4対応 Gemを使わずに自分だけログインできる環境を作る &ndash; Qiita</a></p>

<h3>1. ログイン環境のsessionコントローラを生成</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>rails g controller sessions
</span></code></pre></td></tr></table></div></figure>


<h3>2. viewの作成</h3>

<p><code>views/sessions/new.html.erb</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;span6 offset3&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sr">/div&gt;&lt;%- model_class = User -%&gt;</span>
</span><span class='line'><span class="sr">&lt;div class=&quot;page-header&quot;&gt;</span>
</span><span class='line'><span class="sr">  &lt;!--  &lt;h1&gt;&lt;%=t &#39;.title&#39;, :default =&gt; [:&#39;helpers.titles.new&#39;, &#39;New %{model}&#39;], :model =&gt; model_class.model_name.human.titleize %&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;--&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span><span class='line'><span class="sr">&lt;%= simple_form_for @user, url: sessions_path, html: { class: &#39;form-horizontal&#39; } do |f| %&gt;</span>
</span><span class='line'><span class="sr">  &lt;h2 class=&quot;simple_form-heading&quot;&gt;ログイン&lt;/</span><span class="n">h2</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sx">%= f.input :user_name, label: false, placeholder: &#39;ユーザ名 or メールアドレス&#39;, input_html: { type: &#39;text&#39;, class: &#39;form-control input-xlarge&#39;, id: &#39;user_user_name&#39;} %&gt;</span>
</span><span class='line'><span class="sx">  &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">input</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">label</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">placeholder</span><span class="p">:</span> <span class="s1">&#39;パスワード&#39;</span><span class="p">,</span> <span class="n">input_html</span><span class="p">:</span> <span class="p">{</span> <span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;password_confirm&#39;</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">&#39;form-control input-xlarge&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">&#39;password&#39;</span><span class="p">}</span>  <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">  &lt;%= f.button :submit, label: false, value: &#39;login&#39;, class: &#39;btn btn-lg btn-primary btn-block&#39; %&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sx">% end %&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sx">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3. routes.rbにsessionsのルートを追加</h3>

<p><code>config/routes.rb</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">resources</span> <span class="ss">:sessions</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:new</span><span class="p">,</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>4. controllerを編集</h3>

<p><code>app/controller/session_controller.rb</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">class</span> <span class="nc">SessionsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">new</span>
</span><span class='line'>        <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>        <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by_user_name</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">][</span><span class="ss">:user_name</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">][</span><span class="ss">:password</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>            <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
</span><span class='line'>            <span class="n">redirect_to</span> <span class="n">root_path</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>            <span class="n">flash</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">alert</span> <span class="o">=</span> <span class="s2">&quot;ユーザ名かパスワードが間違っています&quot;</span>
</span><span class='line'>            <span class="kp">new</span><span class="p">()</span>
</span><span class='line'>            <span class="n">render</span> <span class="s2">&quot;new&quot;</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">destroy</span>
</span><span class='line'>        <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>        <span class="n">redirect_to</span> <span class="n">root_path</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>現段階では、ログイン認証に成功すると、root(jantaku)に飛びます。</p>

<h3>5. Viewのヘルパーメソッドでログイン情報を取得できるようにする</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="c1">#app/controller/application_controller.rb</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">current_user</span>
</span><span class='line'>    <span class="vi">@current_user</span> <span class="o">||=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">helper_method</span> <span class="ss">:current_user</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>6. Viewにログイン機能へのパスを書きます。</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;h1&gt;kitaken Top&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">current_user</span> <span class="o">==</span> <span class="kp">nil</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="cp">&lt;%=</span> <span class="n">button_to</span> <span class="s2">&quot;create account&quot;</span><span class="p">,</span> <span class="n">new_user_path</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:get</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;btn btn-lg&quot;</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="cp">&lt;%=</span> <span class="n">button_to</span> <span class="s2">&quot;login&quot;</span><span class="p">,</span> <span class="n">new_session_path</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:get</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span>  <span class="s2">&quot;btn btn-lg&quot;</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="cp">&lt;%</span> <span class="k">else</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">button_to</span> <span class="s2">&quot;logout&quot;</span><span class="p">,</span> <span class="n">session_path</span><span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="ss">data</span><span class="p">:</span> <span class="p">{</span><span class="ss">:confirm</span> <span class="o">=&gt;</span> <span class="s1">&#39;ログアウトしますか？&#39;</span><span class="p">},</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:delete</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;btn btn-lg&quot;</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>未ログイン時</li>
</ul>


<p><img src="https://f.cloud.github.com/assets/1464221/2343867/8611e0e6-a516-11e3-9c6d-e7cf0617eba5.png" alt="2014-03-06 18 58 36" /></p>

<ul>
<li>ログイン時</li>
</ul>


<p><img src="https://f.cloud.github.com/assets/1464221/2343918/7ee8d0c6-a517-11e3-91cc-f748920c79d6.png" alt="2014-03-06 18 59 06" /></p>

<h3>他のcontrollerで次のように書けばログインしていない状態でeditやnewのページに行こうとするとrootへ戻す。</h3>

<h1>controller</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">before_action</span> <span class="ss">:login_check</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:new</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
</span><span class='line'><span class="c1">#各メソッド</span>
</span><span class='line'>
</span><span class='line'><span class="kp">private</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">login_check</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">==</span> <span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>      <span class="n">redirect_to</span> <span class="n">root_path</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>今回、コレは行っていません。</p>

<p>以上！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/03/secdb-rails-2/">Railsで、ユーザの入力したpasswordを暗号化して保存する(実践編)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-03T16:30:03+09:00" pubdate data-updated="true">Mar 3<span>rd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前回調べたセキュアなDB運用の手順を実際にやってみる。</p>

<h3>1. bcrypt-rubyをGemfileに追加する。(passwordをhash化するgem)</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">gem</span> <span class="s1">&#39;bcrypt-ruby&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2. migrationの実行</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>vagrant:% rails generate migration <span class="se">\</span>
</span><span class='line'>&gt; add_password_digest_to_users password_digest:string
</span><span class='line'>
</span><span class='line'>      invoke  active_record
</span><span class='line'>      create    db/migrate/20140303080315_add_password_digest_to_users.rb
</span></code></pre></td></tr></table></div></figure>


<h3>3. userstableにpassword_digestを追加する</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>vagrant:% bundle <span class="nb">exec </span>rake db:migrate                                            <span class="o">[</span>/vagrant/work/Mahjong<span class="o">]</span>
</span><span class='line'><span class="o">==</span>  AddPasswordDigestToUsers: <span class="nv">migrating</span> <span class="o">=======================================</span>
</span><span class='line'>-- add_column<span class="o">(</span>:users, :password_digest, :string<span class="o">)</span>
</span><span class='line'>   -&gt; 0.0008s
</span><span class='line'><span class="o">==</span>  AddPasswordDigestToUsers: migrated <span class="o">(</span>0.0009s<span class="o">)</span> <span class="o">==============================</span>
</span></code></pre></td></tr></table></div></figure>


<h3>4. テスト用のDBの用意</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% bundle <span class="nb">exec </span>rake <span class="nb">test</span>:prepare
</span></code></pre></td></tr></table></div></figure>


<h3>5. パスワードの長さとauthenticateメソッドをテストする。</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">describe</span> <span class="no">User</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">before</span> <span class="k">do</span>
</span><span class='line'>    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Example User&quot;</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span>
</span><span class='line'>                     <span class="ss">password</span><span class="p">:</span> <span class="s2">&quot;foobar&quot;</span><span class="p">,</span> <span class="n">password_confirmation</span><span class="p">:</span> <span class="s2">&quot;foobar&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">subject</span> <span class="p">{</span> <span class="vi">@user</span> <span class="p">}</span>
</span><span class='line'>  <span class="o">.</span>
</span><span class='line'>  <span class="o">.</span>
</span><span class='line'>  <span class="o">.</span>
</span><span class='line'>  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">respond_to</span><span class="p">(</span><span class="ss">:authenticate</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="o">.</span>
</span><span class='line'>  <span class="o">.</span>
</span><span class='line'>  <span class="o">.</span>
</span><span class='line'>  <span class="n">describe</span> <span class="s2">&quot;with a password that&#39;s too short&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">before</span> <span class="p">{</span> <span class="vi">@user</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">password_confirmation</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span> <span class="o">*</span> <span class="mi">5</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">be_invalid</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">describe</span> <span class="s2">&quot;return value of authenticate method&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">before</span> <span class="p">{</span> <span class="vi">@user</span><span class="o">.</span><span class="n">save</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">let</span><span class="p">(</span><span class="ss">:found_user</span><span class="p">)</span> <span class="p">{</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">describe</span> <span class="s2">&quot;with valid password&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="n">found_user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="vi">@user</span><span class="o">.</span><span class="n">password</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">describe</span> <span class="s2">&quot;with invalid password&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">let</span><span class="p">(</span><span class="ss">:user_for_invalid_password</span><span class="p">)</span> <span class="p">{</span> <span class="n">found_user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">eq</span> <span class="n">user_for_invalid_password</span> <span class="p">}</span>
</span><span class='line'>      <span class="n">specify</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">user_for_invalid_password</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_false</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><code>bundle exec rspec spec/</code>を実行</li>
</ol>


<p>するとallOKになるらしいけど、エラーでまくった･･･テストは今は考えないでおきます
取り敢えず進める。</p>

<p>最終的にapp/models/users.rbは次のようになった。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>    <span class="n">before_save</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.</span><span class="n">email_address</span> <span class="o">=</span> <span class="n">email_address</span><span class="o">.</span><span class="n">downcase</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">validates</span> <span class="ss">:user_name</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">50</span> <span class="p">}</span>
</span><span class='line'>    <span class="c1"># 英字:小文字、大文字、数字 format:hoGe@hgoe.hoge</span>
</span><span class='line'>    <span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
</span><span class='line'>    <span class="no">VALID_PASSWORD_REGEX</span> <span class="o">=</span> <span class="sr">/\w/i</span>
</span><span class='line'>    <span class="no">VALID_USERNAME_REGEX</span> <span class="o">=</span> <span class="sr">/\w/i</span>
</span><span class='line'>    <span class="n">validates</span> <span class="ss">:user_name</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>        <span class="nb">format</span><span class="p">:</span>     <span class="p">{</span><span class="ss">with</span><span class="p">:</span> <span class="no">VALID_USERNAME_REGEX</span><span class="p">},</span>
</span><span class='line'>        <span class="ss">length</span><span class="p">:</span>     <span class="p">{</span><span class="ss">maximum</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
</span><span class='line'>        <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span><span class="n">case_sensitive</span><span class="p">:</span> <span class="kp">true</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">validates</span> <span class="ss">:email_address</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>        <span class="nb">format</span><span class="p">:</span>     <span class="p">{</span><span class="ss">with</span><span class="p">:</span> <span class="no">VALID_EMAIL_REGEX</span><span class="p">},</span>
</span><span class='line'>        <span class="ss">length</span><span class="p">:</span>     <span class="p">{</span><span class="ss">maximum</span><span class="p">:</span> <span class="mi">500</span><span class="p">},</span>
</span><span class='line'>        <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span><span class="n">case_sensitive</span><span class="p">:</span> <span class="kp">false</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>        <span class="nb">format</span><span class="p">:</span>     <span class="p">{</span><span class="ss">with</span><span class="p">:</span> <span class="no">VALID_PASSWORD_REGEX</span><span class="p">},</span>
</span><span class='line'>        <span class="ss">length</span><span class="p">:</span>     <span class="p">{</span><span class="ss">within</span><span class="p">:</span> <span class="mi">6</span><span class="o">.</span><span class="n">.</span><span class="mi">30</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">has_secure_password</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>追加したvalidationは</p>

<ol>
<li>username: 30文字以内、記号なし、半角英大文字小文字、数字有り、重複なし</li>
<li>email_address: 100文字以内、記号なし、emailのフォーマットを則っているかを見る</li>
<li>password: 6文字以上30文字以内、記号なし、半角英大文字小文字、数字有り</li>
</ol>


<p>です。</p>

<ul>
<li><p>メモ: 正規表現について</p></li>
<li><p>\A 文字の頭</p></li>
<li>\w 単語構成文字 [a-zA-Z0-9_]</li>
<li>\d 10進数字 [0-9]</li>
</ul>


<p>このへんもおいおい勉強しないと。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/03/secdb-rails/">Railsで、ユーザの入力したpasswordを暗号化して保存する(調査編)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-03T16:27:35+09:00" pubdate data-updated="true">Mar 3<span>rd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ユーザの入力したpasswordをそのまま保存するのは危険！
ので、passwordを暗号化する。</p>

<p>参考: <a href="http://railstutorial.jp/chapters/modeling-users?version=4.0#sec-an_encrypted_password">Ruby on Rails チュートリアル：実例を使って Rails を学ぼう6.3 セキュアなパスワードを追加する</a>
→ 今回セキュアなDBの運用のために引用したけど、全部読んだほうがいいかも。。。</p>

<blockquote><p>セキュアなパスワードの実装は、has_secure_passwordというRailsのメソッドを呼び出すだけでほとんど終わってしまいます (このメソッドはRails 3.1から導入されました)。このメソッド1つだけでセキュアなパスワードの実装がほとんど終わってしまうので、逆にこの機能を最初から手作りするのは簡単ではありません。6.3.2以降では、has_secure_passwordメソッドを早期に導入しておき、テストを新しく書くたびにこのメソッドを一時的にコメントアウトして、正しいテスト駆動開発を行うことをお勧めします。(スクリーンキャストは、このような一からの手作り開発手順を解説するのに向いています。この課題を十分に理解したい方は「Ruby on Railsチュートリアルのスクリーンキャスト (英語)」を参照してください)。</p></blockquote>

<h2>導入手順</h2>

<ol>
<li>userstableに<code>password_digest</code>を追加する</li>
<li>bcrypt-rubyをGemfileに追加する。(passwordをhash化するgem)</li>
<li>Userオブジェクトにpassword_digestカラムがあることを確認するテストを追加
<code>spec/models/user_spec.rb</code></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">describe</span> <span class="no">User</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">before</span> <span class="k">do</span>
</span><span class='line'>    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Example User&quot;</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span>
</span><span class='line'>                     <span class="ss">password</span><span class="p">:</span> <span class="s2">&quot;foobar&quot;</span><span class="p">,</span> <span class="n">password_confirmation</span><span class="p">:</span> <span class="s2">&quot;foobar&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">subject</span> <span class="p">{</span> <span class="vi">@user</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">respond_to</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">respond_to</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">respond_to</span><span class="p">(</span><span class="ss">:password_digest</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">respond_to</span><span class="p">(</span><span class="ss">:password</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">respond_to</span><span class="p">(</span><span class="ss">:password_confirmation</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">be_valid</span> <span class="p">}</span>
</span><span class='line'>  <span class="o">.</span>
</span><span class='line'>  <span class="o">.</span>
</span><span class='line'>  <span class="o">.</span>
</span><span class='line'>  <span class="n">describe</span> <span class="s2">&quot;when password is not present&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">before</span> <span class="k">do</span>
</span><span class='line'>      <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Example User&quot;</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span>
</span><span class='line'>                       <span class="ss">password</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">password_confirmation</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">be_valid</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">describe</span> <span class="s2">&quot;when password doesn&#39;t match confirmation&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">before</span> <span class="p">{</span> <span class="vi">@user</span><span class="o">.</span><span class="n">password_confirmation</span> <span class="o">=</span> <span class="s2">&quot;mismatch&quot;</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">be_valid</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>このコードは、実は次の一行に置き換えられる。
<code>app/models/user_spec.rb</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="o">.</span>
</span><span class='line'>  <span class="o">.</span>
</span><span class='line'>  <span class="o">.</span>
</span><span class='line'>  <span class="n">has_secure_password</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>has_secure_passwordは、</p>

<blockquote><p>password属性とpassword_confirmation属性を追加し、パスワードが存在することを要求し、パスワードとパスワードの確認が一致することを要求し、さらにauthenticateメソッドを使用して、暗号化されたパスワードとpassword_digestを比較してユーザーを認証する</p></blockquote>

<p>ことができるすごいやつ。ソースコードよみたいならココ→<a href="https://github.com/rails/rails/blob/master/activemodel/lib/active_model/secure_password.rb">rails/activemodel/lib/active_model/secure_password.rb at master · rails/rails</a>
(ただし、password_digestカラムを入れておくのを忘れないように。)</p>

<p>セキュアパスワードの最終的な実装は</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">before_save</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">downcase</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">50</span> <span class="p">}</span>
</span><span class='line'>  <span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span>   <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>                    <span class="nb">format</span><span class="p">:</span>     <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="no">VALID_EMAIL_REGEX</span> <span class="p">},</span>
</span><span class='line'>                    <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="kp">false</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">has_secure_password</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">minimum</span><span class="p">:</span> <span class="mi">6</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>こうなる。
時間が来たので、実際にやってみるのは次回。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/28/vim-ruby/">+rubyなvimを入れた奮闘記</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-28T23:33:04+09:00" pubdate data-updated="true">Feb 28<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>使っていたvimが-rubyだったので+rubyにするように奮闘した記録。</p>

<p>現在(2014/02/28)の段階で<code>% brew install vim</code>で入るのがversion 7.4.192なのだが、<code>% brew options vim</code>とかやると</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% brew options vim                                                <span class="o">[</span>~<span class="o">]</span>
</span><span class='line'>--disable-nls
</span><span class='line'>  Build vim without National Language Support <span class="o">(</span>translated messages, keymaps<span class="o">)</span>
</span><span class='line'>--override-system-vi
</span><span class='line'>  Override system vi
</span><span class='line'>--with-client-server
</span><span class='line'>  Enable client/server mode
</span><span class='line'>--with-lua
</span><span class='line'>  Build vim with lua support
</span><span class='line'>--with-mzscheme
</span><span class='line'>  Build vim with mzscheme support
</span><span class='line'>--with-perl
</span><span class='line'>  Build vim with perl support
</span><span class='line'>--with-python3
</span><span class='line'>  Build vim with python3 support
</span><span class='line'>--with-tcl
</span><span class='line'>  Build vim with tcl support
</span><span class='line'>--without-python
</span><span class='line'>  Build vim without python support
</span><span class='line'>--without-ruby
</span><span class='line'>  Build vim without ruby support
</span><span class='line'>--HEAD
</span><span class='line'>  install HEAD version
</span></code></pre></td></tr></table></div></figure>


<p>+rubyにするオプションがなく･･･困った。</p>

<p>しかたがないのでbrewでDLしたvimのsrcファイルに移動して、</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% ls                      <span class="o">(</span>default<span class="o">)[</span>/Library/Caches/Homebrew/vim--hg<span class="o">]</span>
</span><span class='line'>Contents                README_srcdos.txt
</span><span class='line'>Contents.info*          README_unix.txt
</span><span class='line'>Filelist                README_vms.txt
</span><span class='line'>Makefile                README_w32s.txt
</span><span class='line'>README.txt              Vim.info*
</span><span class='line'>README.txt.info*        Xxd.info*
</span><span class='line'>README_ami.txt          configure*
</span><span class='line'>README_ami.txt.info*    csdpmi4b.zip*
</span><span class='line'>README_amibin.txt       farsi/
</span><span class='line'>README_amibin.txt.info* libs/
</span><span class='line'>README_amisrc.txt       nsis/
</span><span class='line'>README_amisrc.txt.info* pixmaps/
</span><span class='line'>README_bindos.txt       runtime/
</span><span class='line'>README_dos.txt          runtime.info*
</span><span class='line'>README_extra.txt        src/
</span><span class='line'>README_mac.txt          src.info*
</span><span class='line'>README_ole.txt          uninstal.txt
</span><span class='line'>README_os2.txt          vimdir.info*
</span><span class='line'>README_os390.txt        vimtutor.bat
</span><span class='line'>README_src.txt          vimtutor.com*
</span><span class='line'>% ./configure --prefix<span class="o">=</span>/usr/local --mandir<span class="o">=</span>/usr/local/Cellar/vim/7.4  --enable-rubyinterp
</span><span class='line'>% make <span class="o">&amp;&amp;</span> make install
</span></code></pre></td></tr></table></div></figure>


<p>とやると</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% vim --version | grep ruby
</span><span class='line'>+diff            +menu            +ruby            +writebackup
</span></code></pre></td></tr></table></div></figure>


<p>できた。</p>

<p>無理やりだけどまぁ、いいや。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/24/pgbackups/">pgbackupsを使って、HerokuのDBをlocalにリストアしてDBにデータをinsertしてHerokuのDBへリストアするまで。</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-24T12:10:02+09:00" pubdate data-updated="true">Feb 24<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>何を使うか。</h2>

<p>調べてみるとpgbackupsというherokuのpluginがあった。コレを使えばherokuのDBからリストアしてローカルで復元、なんてこともできるらしい。</p>

<p>参考: <a href="http://qiita.com/quattro_4/items/a2eb3618207e21ca00d3">Rails &ndash; herokuのデータベースをリセット/リストア/再構築する &ndash; Qiita</a></p>

<h2>やってみた。</h2>

<p>pluginをinstallする。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% heroku addons:add pgbackups
</span><span class='line'>Adding pgbackups on kitaken-mahjong... <span class="k">done</span>, v16 <span class="o">(</span>free<span class="o">)</span>
</span><span class='line'>You can now use <span class="s2">&quot;pgbackups&quot;</span> to backup your databases or import an external backup.
</span><span class='line'>Use <span class="sb">`</span>heroku addons:docs pgbackups<span class="sb">`</span> to view documentation.
</span></code></pre></td></tr></table></div></figure>


<p>backupないか確認</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% heroku pgbackups
</span><span class='line'> !    No backups. Capture one with <span class="sb">`</span>heroku pgbackups:capture<span class="sb">`</span>.
</span></code></pre></td></tr></table></div></figure>


<p>ないので、backupを行う</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% heroku pgbackups:capture
</span><span class='line'>
</span><span class='line'>HEROKU_POSTGRESQL_ORANGE_URL <span class="o">(</span>DATABASE_URL<span class="o">)</span>  ----backup---&gt;  b001
</span><span class='line'>
</span><span class='line'>Capturing... <span class="k">done</span>
</span><span class='line'>Storing... <span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>$ heroku pgbackups --app appname</code>とかすると、appを指定してバックアップできる。
続いて取得したbackupをlocalにDLしてみる。
(追記: <code>curl -o latest.dump</code>heroku pgbackups:url &mdash;app heroku_appname`ってやると一発でdlできるみたい。)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% heroku pgbackups
</span><span class='line'>ID    Backup Time          Status                          Size   Database
</span><span class='line'>----  -------------------  ------------------------------  -----  -------------------------------------------
</span><span class='line'>b001  2014/02/23 09:00.07  Finished @ 2014/02/23 09:00.10  5.9KB  HEROKU_POSTGRESQL_ORANGE_URL <span class="o">(</span>DATABASE_URL<span class="o">)</span>
</span><span class='line'>% heroku pgbackups:url b001
</span><span class='line'><span class="s2">&quot;https://s3.amazonaws.com/hkpgbackups/app22056631@heroku.com/b001.dump?AWSAccessKeyId=(ながいkeyidがずらずら)&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>リンクに行くとb001.dumpというファイルがDLされた。リンクは<strong>約10分後にはAccessDenied</strong>になるらしい。</p>

<p>ではdumpファイルをリストアします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% pg_restore --verbose --clean --no-acl --no-owner -h localhost -U myuser -d mydb b001.dump
</span></code></pre></td></tr></table></div></figure>


<p>myuserに任意のユーザ名、mydbに任意のデータベース名を入れましょう。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% createdb mydb
</span><span class='line'>% pg_restore --verbose --clean --no-acl --no-owner -h localhost -U myuser -d mydb /Users/user/Desktop/b001.dump
</span><span class='line'>pg_restore: connecting to database <span class="k">for </span>restore
</span><span class='line'>pg_restore: dropping INDEX unique_schema_migrations
</span><span class='line'>pg_restore: <span class="o">[</span>archiver <span class="o">(</span>db<span class="o">)]</span> Error <span class="k">while </span>PROCESSING TOC:
</span><span class='line'>pg_restore: <span class="o">[</span>archiver <span class="o">(</span>db<span class="o">)]</span> Error from TOC entry 2728; 1259 1466031 INDEX unique_schema_migrations wblyjdvsoodhup
</span><span class='line'>pg_restore: <span class="o">[</span>archiver <span class="o">(</span>db<span class="o">)]</span> could not execute query: ERROR:  index <span class="s2">&quot;unique_schema_migrations&quot;</span> does not exist
</span><span class='line'>    Command was: DROP INDEX public.unique_schema_migrations;
</span><span class='line'><span class="o">(</span>中略<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>エラーが出まくってる気がするけど気にしない。</p>

<p><code>psql</code>をコマンドラインで実行して</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">user</span><span class="o">=</span><span class="c"># \l</span>
</span><span class='line'>                                         List of databases
</span><span class='line'>           Name            |   Owner   | Encoding |   Collate   |    Ctype    |  Access privileges
</span><span class='line'>---------------------------+-----------+----------+-------------+-------------+---------------------
</span><span class='line'> mydb                      | user   | UTF8     | ja_JP.UTF-8 | ja_JP.UTF-8 |**←コレ**
</span><span class='line'>
</span><span class='line'><span class="nv">user</span><span class="o">=</span><span class="c"># \connect mydb</span>
</span><span class='line'>You are now connected to database <span class="s2">&quot;mydb&quot;</span> as user <span class="s2">&quot;user&quot;</span>.
</span><span class='line'><span class="nv">mydb</span><span class="o">=</span><span class="c"># \d</span>
</span><span class='line'>               List of relations
</span><span class='line'> Schema |       Name        |   Type   | Owner
</span><span class='line'>--------+-------------------+----------+--------
</span><span class='line'> public | schema_migrations | table    | myuser
</span><span class='line'> public | users             | table    | myuser
</span><span class='line'> public | users_id_seq      | sequence | myuser
</span><span class='line'> public | yakus             | table    | myuser
</span><span class='line'> public | yakus_id_seq      | sequence | myuser
</span><span class='line'><span class="o">(</span>5 rows<span class="o">)</span>
</span><span class='line'><span class="nv">mydb</span><span class="o">=</span><span class="c"># select * from users;</span>
</span><span class='line'> id | user_name | email_address | password | created_at | updated_at
</span><span class='line'>----+-----------+---------------+----------+------------+------------
</span><span class='line'><span class="o">(</span>0 rows<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">mydb</span><span class="o">=</span><span class="c"># select * from yakus;</span>
</span><span class='line'> id | name | han | fu |         created_at         |         updated_at
</span><span class='line'>----+------+-----+----+----------------------------+----------------------------
</span><span class='line'>  1 | 平和 |   1 |  0 | 2014-02-09 10:34:56.670672 | 2014-02-09 10:34:56.670672
</span><span class='line'><span class="o">(</span>1 row<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>リストアまで出来ている模様。</p>

<p>\connect知らなくて詰んでた。mysqlでいう<code>use database名</code>みたいに、<code>\connect database名(or \c database名)</code>として使う。あとは<code>\d</code>でtableの情報を表示できる。その他のコマンドについては<a href="http://www.ne.jp/asahi/hishidama/home/tech/postgres/psql.html">ポストグレスpsqlメモ(Hishidama&rsquo;s psql Memo)</a>が一覧で載っててわかりやすいかも。</p>

<h2>localに落としたdbからherokuへリストアしてみよう。</h2>

<p>参考: <a href="http://www.workabroad.jp/posts/2050">ローカルのデータベースをherokuにリストアする | Workabroad.jp</a></p>

<h3>0. DBの書き換え</h3>

<p>今回はYakusのDBに次のように挿入。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">mydb</span><span class="o">=</span><span class="c"># insert into yakus values (2, &#39;断么九&#39;, 1, 20);</span>
</span></code></pre></td></tr></table></div></figure>


<p>断么九の符翻はテキトー。</p>

<h3>1. まずは手元のDBをdumpする。</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>pg_dump -Fc --no-acl --no-owner -h localhost -U myuser mydb &gt; mydb.dump
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>mypassword データベースのパスワード</li>
<li>myuser ユーザー名</li>
<li>mydb データベース名</li>
<li>mydb.dump ダンプのファイル名</li>
</ul>


<h3>2. アップロードする</h3>

<p>herokuにリストアするには、dumpファイルを外部からDL出来る形式にしないといけない。
ここではDropboxにdumpファイルをいれてurlをコピペすることにした。</p>

<p>なお、DropboxからDLのリンクを得るには、
1. Dropbox内からdumpファイルを右クリック
2. Dropboxリンクを共有をクリックしてclipboardにurlをコピー
3. ブラウザでリンクをたどって、ダウンロードボタンのリンクをコピーする
としなければならなかった。</p>

<h3>3. herokuのDBへリストアする</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% heroku pgbackups:restore DATABASE <span class="s1">&#39;https://dl.dropboxusercontent.com/s/ほげほげ&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>とする。
DATABASEには、<code>heroku config</code>で<code>HEROKU_POSTGRESQL_{COLOR}_URL</code>が出てくるはずなので、COLORを自分の環境で表示された色で置き換えて、実行するとOK.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% heroku pgbackups:restore HEROKU_POSTGRESQL_<span class="o">{</span>COLOR<span class="o">}</span>_URL <span class="o">(</span>以下略<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>HEROKU_POSTGRESQL_<span class="o">{</span>COLOR<span class="o">}</span>_URL <span class="o">(</span>DATABASE_URL<span class="o">)</span>  &lt;---restore---  mydb.dump
</span><span class='line'>
</span><span class='line'>Retrieving... <span class="k">done</span>
</span><span class='line'>Restoring... <span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>出来た！herokuappを確認してみよう。</p>

<p><img src="https://f.cloud.github.com/assets/1464221/2242377/54a66162-9d00-11e3-9640-e774af5c6995.png" alt="2014-02-24 12 03 46" /></p>

<p>出来てる！</p>

<h1>おまけ</h1>

<h2>pgbackupsで使えるコマンド一覧</h2>

<p><code>heroku help pg</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% heroku <span class="nb">help </span>pg
</span><span class='line'>Usage: heroku pg
</span><span class='line'>
</span><span class='line'> list databases <span class="k">for </span>an app
</span><span class='line'>
</span><span class='line'>Additional commands, <span class="nb">type</span> <span class="s2">&quot;heroku help COMMAND&quot;</span> <span class="k">for </span>more details:
</span><span class='line'>
</span><span class='line'>  pg:credentials DATABASE                                   <span class="c">#  display the DATABASE credentials.</span>
</span><span class='line'>  pg:info <span class="o">[</span>DATABASE<span class="o">]</span>                                        <span class="c">#</span>
</span><span class='line'>  pg:kill procpid <span class="o">[</span>DATABASE<span class="o">]</span>                                <span class="c">#  kill a query</span>
</span><span class='line'>  pg:killall <span class="o">[</span>DATABASE<span class="o">]</span>                                     <span class="c">#  terminates ALL connections</span>
</span><span class='line'>  pg:promote DATABASE                                       <span class="c">#  sets DATABASE as your DATABASE_URL</span>
</span><span class='line'>  pg:ps <span class="o">[</span>DATABASE<span class="o">]</span>                                          <span class="c">#  view active queries with execution time</span>
</span><span class='line'>  pg:psql <span class="o">[</span>DATABASE<span class="o">]</span>                                        <span class="c">#</span>
</span><span class='line'>  pg:pull &lt;REMOTE_SOURCE_DATABASE&gt; &lt;LOCAL_TARGET_DATABASE&gt;  <span class="c">#  pull from REMOTE_SOURCE_DATABASE to LOCAL_TARGET_DATABASE</span>
</span><span class='line'>  pg:push &lt;LOCAL_SOURCE_DATABASE&gt; &lt;REMOTE_TARGET_DATABASE&gt;  <span class="c">#  push from LOCAL_SOURCE_DATABASE to REMOTE_TARGET_DATABASE</span>
</span><span class='line'>  pg:reset DATABASE                                         <span class="c">#  delete all data in DATABASE</span>
</span><span class='line'>  pg:unfollow REPLICA                                       <span class="c">#  stop a replica from following and make it a read/write database</span>
</span><span class='line'>  pg:wait <span class="o">[</span>DATABASE<span class="o">]</span>                                        <span class="c">#  monitor database creation, exit when complet</span>
</span></code></pre></td></tr></table></div></figure>


<h2>試してみた。</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% heroku pg:info
</span><span class='line'><span class="o">===</span> HEROKU_POSTGRESQL_ORANGE_URL <span class="o">(</span>DATABASE_URL<span class="o">)</span>
</span><span class='line'>Plan:        Hobby-dev
</span><span class='line'>Status:      available
</span><span class='line'>Connections: 0
</span><span class='line'>PG Version:  9.3.3
</span><span class='line'>Created:     2014-02-09 10:02 UTC
</span><span class='line'>Data Size:   6.5 MB
</span><span class='line'>Tables:      3
</span><span class='line'>Rows:        3/10000 <span class="o">(</span>In compliance<span class="o">)</span>
</span><span class='line'>Fork/Follow: Unsupported
</span><span class='line'>Rollback:    Unsupported
</span></code></pre></td></tr></table></div></figure>


<p>herokuのDBで無料で作成できるのは10000件までらしいです。超えたままだと一週間後にINSERTできなくなるとか。行削除、再構築などをすれば利用継続できるそう。</p>

<h2>他に便利なコマンド</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># データベースマイグレーション</span>
</span><span class='line'>heroku run rake db:migrate
</span><span class='line'>heroku run rake db:seed
</span><span class='line'><span class="c"># 環境の確認 (ENVの値など)</span>
</span><span class='line'>heroku config
</span><span class='line'><span class="c"># railsコンソール</span>
</span><span class='line'>heroku run console
</span><span class='line'>&gt; JunkData.delete_all
</span><span class='line'><span class="c"># ログ確認</span>
</span><span class='line'>% heroku logs -t
</span></code></pre></td></tr></table></div></figure>


<p>以上!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/09/jenkins-plugin/">Jenkinsさんにイカしたpluginを入れてみよう！</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-09T14:05:01+09:00" pubdate data-updated="true">Feb 9<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>jenkinsのpluginはかなりたくさんある！</p>

<p>そんな中でよさ気なpluginを入れてみました。</p>

<ul>
<li><p>参考:<a href="http://sue445.hatenablog.com/entry/2014/01/08/225128">Jenkinsに入れているプラグインまとめ（Rails中心） &ndash; くりにっき</a></p></li>
<li><p>AnsiColor Plugin &ndash; Jenkins &ndash; Jenkins Wiki</p>

<ul>
<li>コンソールに色がつく。</li>
</ul>
</li>
<li>Green Balls &ndash; Jenkins &ndash; Jenkins Wiki

<ul>
<li>デフォルトでテストが成功すると青になるボールを緑にする。このへんは完全に好み。</li>
</ul>
</li>
<li><p>Emotional Jenkins Plugin</p>

<ul>
<li>ビルドが失敗するとJenkinsさんが鬼の形相に、不安定だと不安げに。コレも好み。</li>
</ul>
</li>
<li><p>monitoring Plugin</p>

<ul>
<li>/monitoringでjenkinsさんの状態をグラフで解りやすく表示してくれる！</li>
</ul>
</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/08/jenkins-rspec/">Bundle Exec Rspec spec/*/*.featureが失敗する件</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-08T13:56:16+09:00" pubdate data-updated="true">Feb 8<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ローカル環境で</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bundle install --path vendor/bundle
</span><span class='line'>bundle exec rake db:migrate
</span><span class='line'>bundle exec rake db:test:clone
</span><span class='line'>bundle exec rspec spec/*/*.feature</span></code></pre></td></tr></table></div></figure>


<p>を実行すると、
<em>bundle exec rspec spec/*/*.feature</em>
で</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>% bundle exec rspec spec/*/*.feature          
</span><span class='line'>syntax error, unexpected ':', expecting end-of-input (SyntaxError)
</span><span class='line'>機能: ユーザー管理
</span><span class='line'>       ^</span></code></pre></td></tr></table></div></figure>


<p>エラーが出た(´・ω・`)</p>

<ul>
<li>参考:<a href="http://www.buildinsider.net/enterprise/jenkins/02">Jenkinsで小さなテストを実行してみよう（Mac OS X＆Linux）［Ruby、Rails］ &ndash; Build Insider</a></li>
</ul>


<p>rspecでGherkin記法で記述したfeatureファイルが実行できないよ> &lt; ってことらしい。</p>

<p>.rspecファイルに次のような記述をする。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-r turnip/rspec --color --format documentation</span></code></pre></td></tr></table></div></figure>


<p>出力に色つけてturnip(RSpecからGherkin記法で記述したテストを実行できるフレームワーク)のrspec使って実行しなさいよーということ･･･かな。</p>

<p>ここまで出来たのでJenkinsサーバの.rspecも直して実行すると･･･成功しました!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/09/24/dc/">DCコマンドで拡張子を指定して容量を表示する</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/22/heroku-icon/">Fonticonをherokuに適応するまで</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/08/jquery-lesson/">dotinstallでjQueryの勉強</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/07/rails-sec-login/">Railsで、暗号化されたpasswordを使ってログイン機構を作ってみる。</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/03/secdb-rails-2/">Railsで、ユーザの入力したpasswordを暗号化して保存する(実践編)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/03/secdb-rails/">Railsで、ユーザの入力したpasswordを暗号化して保存する(調査編)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/28/vim-ruby/">+rubyなvimを入れた奮闘記</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/24/pgbackups/">pgbackupsを使って、HerokuのDBをlocalにリストアしてDBにデータをinsertしてHerokuのDBへリストアするまで。</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/09/jenkins-plugin/">Jenkinsさんにイカしたpluginを入れてみよう！</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/08/jenkins-rspec/">Bundle Exec Rspec spec/*/*.featureが失敗する件</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/27/rails-iconfont/">Railsでfonticon</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/27/nginx-jenkins/">さくらVPSにjenkinsとNginxでJenkinsサーバを構築する。</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/26/rails-bootstrap/">Rails+bootstrapなアプリケーションを作る</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/26/heroku-RoR/">herokuへRuby on Railsアプリケーションをdeployするまで</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/19/about_jenkins/">Jenkinsについて学ぶ</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/18/octpress/">Octpressを導入してイカすBlogを作る</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/18/rails_app/">Rails アプリケーション作成の手順</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/12/vagrant/">VagrantでCentOSを入れてRails環境構築</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/12/jekyll/">github+page+jekyll+jekyll+bootstarpでBlogを始めたかったんだ</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/12/about_Jenkins_Chef_Bundle/">Jenkins Chef Bundleについて調べた</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/rice-american">@rice-american</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'rice-american',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - rice_american -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
